---
title: "CustomerPersonalityAnalysis_StudyGroup12"
author: "Akshat Kacheria, Asli Ceren Memis, Jelena Savic, Shengcheng Liu, Shuhan Li, Sophia Kalusche "
date: "11/9/2021"
output: html_document
---

# Introduction

# Background

```{r setup, include=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(lubridate)
library(janitor)
library(vroom)
library(skimr)
library(sf)
library(leaflet)
library(tmap)
library(tmaptools)
library(hrbrthemes)
library(mapview)
library(viridis)
library(knitr)

library(readr)
marketing_campaign <- read_delim("marketing_campaign.csv", 
    "\t", escape_double = FALSE, trim_ws = TRUE)
View(marketing_campaign)

glimpse(marketing_campaign)

skim(marketing_campaign)
#we see that income column has 24 NA values, we can remove those rows
#we also notice that a few year of births are impractically old, we remove all years before 1920

profile_clean <- marketing_campaign %>% 
  janitor::clean_names() %>% 
  drop_na(income) %>% 
  filter(year_birth > 1925)

skim(profile_clean)

```



```{r}
df1=na.omit(profile_clean)
df1['Age']= 2021-df1$year_birth
df1['Child']=df1$kidhome+df1$teenhome

df1['total_spent']=df1$mnt_meat_products+df1$mnt_fish_products+df1$mnt_wines+df1$mnt_fruits+df1$mnt_sweet_products+df1$mnt_gold_prods

df1['accepted']=df1$accepted_cmp1+df1$accepted_cmp2+df1$accepted_cmp3+df1$accepted_cmp4+df1$accepted_cmp5
head(df1)

df1=df1[c(-1,-2,-6,-7,-8,-10,-11,-12,-13,-14,-15,-21,-22,-23,-24,-25,-27,-28)]


```



```{r}
library(caret)

dmy <- dummyVars(" ~ .", data = df1, fullRank = T)
dat_transformed <- data.frame(predict(dmy, newdata = df1))

#glimpse(dat_transformed)

dfc=dat_transformed[c(7,8,13,14,15,16,17,18,19,20,21,22,23,24)]


library(factoextra)

fviz_nbclust(dfc,kmeans,method="wss")+geom_vline(xintercept=2,linetype=2)


```

```{r}

set.seed(123)
km.res <- kmeans(dfc,2, nstart = 10)

fviz_cluster(km.res, dfc, geom = "point",ellipse.type = "norm",repel = TRUE, ggtheme = theme_minimal(), xlab="", ylab="")+
  ggtitle(label="Customer segments")+
  scale_color_manual(values=c("tomato", "cornflowerblue"))
  

```

```{r}
#centroids
df1<-df1 %>% 
  select(-education, -marital_status)


user <- data.frame(scale(df1))


#train kmeans clustering
model_kmeans_2clusters <- eclust(user, "kmeans", k = 2, nstart=50, graph=FALSE)
#df with cluster centers and cluster numbers 
cluster_centers <- data.frame(cluster=as.factor(c(1:2)),model_kmeans_2clusters$centers)

#transpose
cluster_centers_t <- cluster_centers %>% gather(variable, value, -cluster, factor_key=TRUE)

```
  
```{r}
#plot the clusters
graphkmeans_2clusters <- ggplot(cluster_centers_t, aes(x=variable, y=value))+
  geom_line(aes(color=cluster, group=cluster), linetype="dashed", size=1)+
  geom_point(size=1, shape=4)+
  geom_hline(yintercept=0)+
  theme_minimal()+
  theme(text = element_text(size=10),
        axis.text.x = element_text(angle=45, hjust=1),)+
  ggtitle("Customer cluster centers") +
  scale_color_manual(values=c("tomato", "cornflowerblue"))+
  labs(y="", x="")
graphkmeans_2clusters

```
  
  